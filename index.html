<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å°å·¥å…·</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      background-color: #fdf6ee;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      background-color: #fff8f2;
      border-radius: 20px;
      box-shadow: 0 4px 8px rgba(100, 62, 35, 0.1);
      width: 40%;
      padding: 40px;
      text-align: center;
    }
    h1 {
      color: #6f4e37;
      font-weight: bold;
      margin-bottom: 30px;
    }
    .input-field, .button-group {
      margin-bottom: 25px;
    }
    input[type="text"] {
      padding: 10px;
      width: 80%;
      font-weight: bold;
      text-align: center;
      border: 1px solid #d9cfc2;
      border-radius: 8px;
      font-size: 16px;
    }
    .label {
      color: #6f4e37;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      background-color: #e6c8aa;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      color: black;
      min-width: 80px;
    }
    button.active, button:hover {
      background-color: #d2a679;
    }
    button:disabled {
      background-color: #eee;
      cursor: not-allowed;
    }
    #generate {
      margin-top: 35px;
      background-color: #b87943;
      color: white;
      font-size: 18px;
      padding: 14px 30px;
      font-weight: bold;
      border-radius: 12px;
      width: 100%;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>å°å·¥å…·ğŸ› ï¸</h1>

    <div class="input-field">
      <div class="label">é–€å¸‚ä»£ç¢¼</div>
      <input type="text" id="store" maxlength="3" placeholder=""/>
    </div>

    <div class="input-field">
      <div class="label">ç”¨é¤æ–¹å¼</div>
      <div class="button-group" id="mealType">
        <button onclick="selectOption(this, 'meal')">å…§ç”¨</button>
        <button onclick="selectOption(this, 'meal')">å¤–å¸¶</button>
        <button onclick="selectOption(this, 'meal')">å¤–é€</button>
      </div>
    </div>

    <div class="input-field">
      <div class="label">é»é¤æ–¹å¼</div>
      <div class="button-group" id="orderType">
        <button onclick="selectOption(this, 'order')">é»é¤æ©Ÿ</button>
        <button onclick="selectOption(this, 'order')">æ«ƒæª¯</button>
        <button onclick="selectOption(this, 'order')">ç¶²è¨‚</button>
      </div>
    </div>

    <button id="generate" onclick="generateLink()">ğŸš€ ä¸€éµç”¢ç”Ÿå•å·é€£çµ</button>
  </div>

  <script>
    let meal = "";
    let order = "";

    const deliveryTailCodes = ["10050001","14480005","13350004","12230003","18600010","13450002","15200006","13850008"];
    const normalTailCodes = ["14552233","15780010","13117744","10885001","15362222","14930006","16350003","15440007"];

    function selectOption(button, type) {
      const group = type === "meal" ? "mealType" : "orderType";
      const buttons = document.querySelectorAll(`#${group} button`);
      buttons.forEach(b => b.classList.remove("active"));
      button.classList.add("active");

      if (type === "meal") {
        meal = button.innerText;

        // å¤–é€åªèƒ½é¸ç¶²è¨‚
        const orderButtons = document.querySelectorAll("#orderType button");
        orderButtons.forEach(b => {
          if (meal === "å¤–é€") {
            if (b.innerText !== "ç¶²è¨‚") {
              b.disabled = true;
              b.classList.remove("active");
            } else {
              b.disabled = false;
              b.classList.add("active");
              order = "ç¶²è¨‚";
            }
          } else {
            b.disabled = false;
          }
        });
      } else {
        order = button.innerText;
      }
    }

    function generateLink() {
      const store = document.getElementById("store").value.trim();
      if (!store || store.length !== 3) {
        alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„ 3 ç¢¼é–€å¸‚ä»£ç¢¼");
        return;
      }

      const now = new Date();
      now.setDate(now.getDate() - 1);
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth() + 1).padStart(2, "0");
      const dd = String(now.getDate()).padStart(2, "0");

      const s = Math.floor(Math.random() * (22 - 10 + 1)) + 10;
      const r1 = Math.floor(Math.random() * 90 + 10);
      const r2 = Math.floor(Math.random() * 50 + 10);
      const r3 = Math.floor(Math.random() * 89 + 11);
      const time = `${s}${r1}${r2}${r3}`;

      let tail = "";

      if (meal === "å¤–é€") {
        const randomIndex = Math.floor(Math.random() * deliveryTailCodes.length);
        tail = deliveryTailCodes[randomIndex];
      } else {
        const useFixed = Math.random() < 0.6;
        if (useFixed) {
          const randomIndex = Math.floor(Math.random() * normalTailCodes.length);
          tail = normalTailCodes[randomIndex];
        } else {
          tail = time;
        }
      }

      const O = meal === "å¤–é€" ? 4 : meal === "å¤–å¸¶" ? 2 : 1;
      const K = order === "é»é¤æ©Ÿ" ? 3 : order === "æ«ƒæª¯" ? 2 : 2;
      const Q = {
        S: `886KTWI${store}`,
        U: `TWI${store}${yyyy}${mm}${dd}${tail}`,
        D: `${yyyy}${mm}${dd}`,
        T: tail,
        Country: "TW",
        O,
        M: 4,
        K
      };
      const encoded = btoa(JSON.stringify(Q));
      const link = `https://customer.kfc-listens.com/jfe/form/SV_1R1VSPEYVPlV1JA?Q_EED=${encoded}`;

      navigator.clipboard.writeText(link).then(() => {
        alert("å·²è¤‡è£½æˆåŠŸï¼");
      });
    }
  </script>
</body>
</html>