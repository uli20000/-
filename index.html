<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 FIT - Mifa's Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #FDFEFF; color: #1E293B; }
        .glass-card { background: white; border-radius: 30px; border: 1px solid #F1F5F9; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.02); }
        .dark-card { background: linear-gradient(135deg, #1E293B 0%, #334155 100%); border-radius: 32px; color: white; }
        .sky-accent { background: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%); }
        .progress-bar { transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); }
    </style>
</head>
<body class="pb-12">

    <div class="max-w-2xl mx-auto p-6 space-y-6">
        <header class="px-2 pt-4">
            <h1 class="text-3xl font-black italic tracking-tighter text-slate-800">2026 <span class="text-blue-500">FIT</span></h1>
            <p id="currentDate" class="text-slate-400 font-bold text-[10px] uppercase tracking-widest mt-1"></p>
        </header>

        <div class="dark-card p-8 shadow-2xl space-y-8">
            <div class="space-y-4">
                <div class="flex justify-between items-end">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">Calorie Budget</span>
                    <span id="kcalPercent" class="text-2xl font-black text-blue-400">0%</span>
                </div>
                <div class="w-full bg-slate-700/50 rounded-full h-4 p-1">
                    <div id="kcalBar" class="sky-accent h-full rounded-full progress-bar" style="width: 0%"></div>
                </div>
                <div class="flex justify-between items-baseline">
                    <p id="kcalText" class="text-5xl font-black italic tracking-tighter">0 <span class="text-xl text-slate-500 ml-2">/ 0</span></p>
                    <p id="tdeeGoalText" class="text-[10px] text-slate-500 font-bold italic"></p>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-6 border-t border-slate-700/50 pt-8">
                <div class="text-center space-y-2">
                    <p class="text-[9px] font-black text-slate-500 uppercase">ËõãÁôΩË≥™</p>
                    <p id="totalPro" class="text-xl font-bold">0g</p>
                    <div class="h-1 bg-slate-700 rounded-full overflow-hidden"><div id="proBar" class="bg-blue-400 h-full progress-bar" style="width: 0%"></div></div>
                    <p id="goalPro" class="text-[9px] text-slate-500 font-bold mt-1"></p>
                </div>
                <div class="text-center space-y-2">
                    <p class="text-[9px] font-black text-slate-500 uppercase">Á¢≥Ê∞¥</p>
                    <p id="totalCarb" class="text-xl font-bold">0g</p>
                    <div class="h-1 bg-slate-700 rounded-full overflow-hidden"><div id="carbBar" class="bg-blue-300 h-full progress-bar" style="width: 0%"></div></div>
                    <p id="goalCarb" class="text-[9px] text-slate-500 font-bold mt-1"></p>
                </div>
                <div class="text-center space-y-2">
                    <p class="text-[9px] font-black text-slate-500 uppercase">ËÑÇËÇ™</p>
                    <p id="totalFat" class="text-xl font-bold">0g</p>
                    <div class="h-1 bg-slate-700 rounded-full overflow-hidden"><div id="fatBar" class="bg-blue-200 h-full progress-bar" style="width: 0%"></div></div>
                    <p id="goalFat" class="text-[9px] text-slate-500 font-bold mt-1"></p>
                </div>
            </div>
        </div>

        <div class="glass-card p-6 flex items-center justify-between">
            <div class="space-y-1">
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest italic">Water Goal</p>
                <p id="waterText" class="text-3xl font-black italic text-slate-700">0 <span class="text-sm text-slate-400 ml-1">/ 3000 cc</span></p>
            </div>
            <div class="flex gap-2">
                <button onclick="addWater(200)" class="sky-accent text-white w-14 h-14 rounded-2xl font-black text-sm shadow-lg active:scale-90 transition">+200</button>
                <button onclick="addWater(-100)" class="bg-slate-100 text-slate-400 w-14 h-14 rounded-2xl font-black text-xs active:scale-90 transition">-100</button>
            </div>
        </div>

        <div class="glass-card p-6 space-y-4">
            <div class="flex gap-2">
                <input type="text" id="foodInput" placeholder="ÊêúÂ∞ã..." class="w-full bg-slate-50 border-none p-4 rounded-2xl text-sm font-bold outline-none focus:ring-2 focus:ring-blue-100">
                <button onclick="handleSearch()" class="sky-accent text-white px-6 rounded-2xl font-black">ÊêúÂ∞ã</button>
            </div>
            <div id="searchResult" class="hidden bg-blue-50/50 p-4 rounded-3xl border border-blue-100">
                <p id="resName" class="font-black text-slate-600 text-sm mb-3 px-1"></p>
                <div class="flex gap-2 items-center">
                    <input type="number" id="foodAmount" placeholder="..." class="w-20 p-2.5 rounded-xl border-none font-bold text-blue-600 text-sm shadow-inner">
                    <button onclick="addToDiary()" class="flex-1 sky-accent text-white py-2.5 rounded-xl font-black text-sm shadow-md">Á¢∫Ë™çÂä†ÂÖ•</button>
                </div>
            </div>
            <div id="todayItems" class="space-y-2"></div>
        </div>

        <div class="glass-card p-6">
            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Weight History</p>
            <div class="flex gap-3">
                <input type="number" id="weightInput" step="0.1" placeholder=" kg " class="w-full bg-slate-50 border-none p-4 rounded-2xl text-lg font-bold outline-none">
                <button onclick="saveWeight()" class="bg-slate-800 text-white px-8 rounded-2xl font-black shadow-lg">ÂÑ≤Â≠ò</button>
            </div>
        </div>

        <div class="glass-card p-7">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-sm font-black italic text-slate-700">È´îÈáçË∂®Âã¢ÂàÜÊûê</h3>
                <button onclick="deleteLastWeight()" class="text-[10px] text-slate-300 font-bold hover:text-red-400">Âà™Èô§ÊúÄÂæå‰∏ÄÁ≠Ü</button>
            </div>
            <div class="h-64"><canvas id="weightChart"></canvas></div>
        </div>

        <div class="text-center pt-4">
            <button onclick="exportAllData()" class="w-full sky-accent text-white py-4 rounded-2xl font-black shadow-xl mb-4">üìä Â∞éÂá∫ÂÆåÊï¥ÂÇô‰ªΩ CSV</button>
            <p class="text-[10px] text-slate-300 font-black tracking-[0.4em] uppercase cursor-pointer" onclick="if(confirm('ÈáçÁΩÆÁ≥ªÁµ±Ôºü')){localStorage.clear();location.reload();}">System Reset</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const APP_ID = '3b185717', APP_KEY = '023d04b5d811e3b080c6e899752092b8';
        const MY_HEIGHT = 167, MY_AGE = 31, WATER_GOAL = 3000;
        const todayStr = new Date().toLocaleDateString();
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString('zh-TW', {year:'numeric', month:'long', day:'numeric'});

        let diary = JSON.parse(localStorage.getItem('mifa_diary')) || { items: [], water: 0, date: todayStr };
        if (diary.date !== todayStr) {
            saveToHistory(diary);
            diary = { items: [], water: 0, date: todayStr };
        }
        let weightHistory = JSON.parse(localStorage.getItem('mifa_weight')) || [];
        let tempNutrients = null, weightChart = null, lastChineseInput = "";

        function sync() {
            localStorage.setItem('mifa_diary', JSON.stringify(diary));
            localStorage.setItem('mifa_weight', JSON.stringify(weightHistory));
            updateUI();
            updateCharts();
        }

        async function handleSearch() {
            const raw = document.getElementById('foodInput').value;
            if(!raw) return;
            lastChineseInput = raw;
            let query = raw;
            if (!/^[a-zA-Z\s]+$/.test(raw)) {
                const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-TW&tl=en&dt=t&q=${encodeURIComponent(raw)}`);
                const data = await res.json(); query = data[0][0][0];
            }
            const resFood = await fetch(`https://api.edamam.com/api/food-database/v2/parser?app_id=${APP_ID}&app_key=${APP_KEY}&ingr=${query}`);
            const foodData = await resFood.json();
            if(foodData.hints && foodData.hints[0]) {
                tempNutrients = foodData.hints[0].food.nutrients;
                document.getElementById('searchResult').classList.remove('hidden');
                document.getElementById('resName').innerText = `Â∑≤ÊêúÂ∞ã: ${lastChineseInput}`;
            }
        }

        function addToDiary() {
            const amt = parseFloat(document.getElementById('foodAmount').value);
            if(!amt || !tempNutrients) return;
            diary.items.push({ id: Date.now(), name: lastChineseInput, kcal: tempNutrients.ENERC_KCAL * (amt/100), pro: tempNutrients.PROCNT * (amt/100), carb: tempNutrients.CHOCDF * (amt/100), fat: tempNutrients.FAT * (amt/100), amt: amt });
            document.getElementById('searchResult').classList.add('hidden');
            document.getElementById('foodInput').value = '';
            sync();
        }

        function updateUI() {
            const sums = diary.items.reduce((acc, cur) => { acc.kcal += cur.kcal; acc.pro += cur.pro; acc.carb += cur.carb; acc.fat += cur.fat; return acc; }, {kcal:0, pro:0, carb:0, fat:0});
            const lastW = weightHistory.length > 0 ? weightHistory[weightHistory.length-1].val : 62.5;
            const targetKcal = Math.round(((10 * lastW) + (6.25 * MY_HEIGHT) - (5 * MY_AGE) - 161) * 1.2 - 400);
            const goalPro = Math.round(lastW * 1.6), goalFat = Math.round((targetKcal * 0.25) / 9), goalCarb = Math.round((targetKcal - (goalPro * 4) - (goalFat * 9)) / 4);

            document.getElementById('kcalPercent').innerText = Math.round(sums.kcal/targetKcal*100) + '%';
            document.getElementById('kcalBar').style.width = Math.min((sums.kcal/targetKcal*100), 100) + '%';
            document.getElementById('kcalText').innerHTML = `${Math.round(sums.kcal)} <span class="text-xl text-slate-500 italic ml-2">/ ${targetKcal}</span>`;
            document.getElementById('tdeeGoalText').innerText = `Âü∫Ê∫ñÈ´îÈáç: ${lastW}kg`;
            
            const upNut = (id, cur, goal, bId) => {
                document.getElementById(id).innerText = Math.round(cur) + 'g';
                document.getElementById('goal' + id.slice(5)).innerText = `/ ${goal}g`;
                document.getElementById(bId).style.width = Math.min((cur/goal*100), 100) + '%';
            };
            upNut('totalPro', sums.pro, goalPro, 'proBar');
            upNut('totalCarb', sums.carb, goalCarb, 'carbBar');
            upNut('totalFat', sums.fat, goalFat, 'fatBar');
            document.getElementById('waterText').innerHTML = `${diary.water} <span class="text-sm text-slate-400 italic">/ ${WATER_GOAL} cc</span>`;

            document.getElementById('todayItems').innerHTML = diary.items.map(i => `<div onclick="deleteItem(${i.id})" class="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100 px-4 py-3"><span class="text-slate-700 font-bold text-xs">${i.name} (${i.amt}g)</span><span class="font-black text-blue-500 text-xs">${Math.round(i.kcal)} kcal</span></div>`).join('');
        }

        function updateCharts() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            const recent = weightHistory.slice(-7);
            if(weightChart) weightChart.destroy();
            const grad = ctx.createLinearGradient(0, 0, 0, 400);
            grad.addColorStop(0, 'rgba(59, 130, 246, 0.2)'); grad.addColorStop(1, 'rgba(255, 255, 255, 0)');
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: recent.map(h => h.date),
                    datasets: [{ 
                        data: recent.map(h => h.val), 
                        borderColor: '#3B82F6', borderWidth: 3, pointBackgroundColor: '#FFFFFF', pointBorderColor: '#3B82F6', pointBorderWidth: 2, pointRadius: 5, fill: true, backgroundColor: grad, tension: 0.4 
                    }]
                },
                options: { 
                    maintainAspectRatio: false, plugins: { legend: { display: false } },
                    scales: { y: { grid: { color: '#F1F5F9' }, ticks: { color: '#94A3B8', font: { size: 10 } } }, x: { grid: { display: false }, ticks: { color: '#94A3B8', font: { size: 10 } } } }
                }
            });
        }

        function saveToHistory(oldDiary) {
            let history = JSON.parse(localStorage.getItem('mifa_food_history')) || [];
            history.push(oldDiary);
            if (history.length > 30) history.shift();
            localStorage.setItem('mifa_food_history', JSON.stringify(history));
        }

        function exportAllData() {
            let csv = "\uFEFFÈ°ûÂà•,Êó•Êúü,ÂÖßÂÆπ,Êï∏ÂÄº,ËõãÁôΩË≥™,Á¢≥Ê∞¥,ËÑÇËÇ™\n";
            weightHistory.forEach(h => csv += `È´îÈáçÊ≠∑Âè≤,${h.date},È´îÈáçÊï∏Êìö,${h.val}kg,,,,\n`);
            let history = JSON.parse(localStorage.getItem('mifa_food_history')) || [];
            [...history, diary].forEach(day => {
                day.items.forEach(i => { csv += `È£≤È£üÊòéÁ¥∞,${day.date},${i.name},${i.amt}g,${Math.round(i.pro)}g,${Math.round(i.carb)}g,${Math.round(i.fat)}g\n`; });
            });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv' }));
            link.download = `Mifa_FIT_Full_Data.csv`; link.click();
        }

        function deleteItem(id) { diary.items = diary.items.filter(i => i.id !== id); sync(); }
        function addWater(cc) { diary.water += cc; if(diary.water < 0) diary.water = 0; sync(); }
        function saveWeight() {
            const v = document.getElementById('weightInput').value;
            if(!v) return;
            weightHistory.push({ date: new Date().toLocaleDateString().slice(5), val: parseFloat(v) });
            document.getElementById('weightInput').value = '';
            sync();
        }
        function deleteLastWeight() { if(confirm("Âà™Èô§ÊúÄÂæå‰∏ÄÁ≠ÜÈ´îÈáçÔºü")) { weightHistory.pop(); sync(); } }
        window.onload = sync;
    </script>
</body>
</html>
